# チェス棋譜自動記録システム

## 概要

ArUcoマーカーを使用してチェスのゲームを自動的に記録するWebアプリケーション。各チェスピースにマーカーを貼り付け、カメラで読み取ることで盤面の状態を認識し、PGN形式で棋譜を記録します。

## デモ

### マーカー検出画面
カメラでチェスピースのマーカーをリアルタイムで検出します。

![マーカー検出画面](images/01-index-page.png)

### マーカー一覧（印刷用）
全32個のチェスピース用マーカーを1ページで印刷できます。

![マーカー一覧](images/02-all-markers-page.png)

### マーカー生成ツール
個別にマーカーを生成・ダウンロードできます。

![マーカー生成ツール](images/03-marker-generator-page.png)

## 特徴

- ✅ **複数マーカーの同時検出**: 最大50個のマーカーをリアルタイムで検出
- ✅ **ピース自動認識**: 32個のチェスピースに自動割り当て
- ✅ **印刷最適化**: 全マーカーを1ページで印刷可能
- ✅ **軽量**: js-aruco2使用で高速動作
- 🚧 **盤面認識**: マス目検出（開発予定）
- 🚧 **棋譜記録**: PGN形式での記録（開発予定）

## セットアップ

### 必要要件

- Webブラウザ（Chrome/Firefox/Safari推奨）
- Webカメラ
- プリンター（マーカー印刷用）

### インストール

```bash
# リポジトリのクローン
git clone https://github.com/champierre/auto-pgn.git
cd auto-pgn

# 依存パッケージのインストール
npm install
```

### 使い方

1. **マーカーの準備**
   - `all-markers.html`をブラウザで開く
   - 「印刷する」ボタンをクリックして全32個のマーカーを印刷
   - 各マーカーを切り取ってチェスピースに貼り付け

2. **マーカー検出**
   - `index.html`をブラウザで開く
   - 「カメラ起動」ボタンをクリック
   - チェスピースをカメラに向けて検出を確認

## ピースの割り当て

### 白のピース（ID: 0-15）
| ID | ピース |
|----|--------|
| 0 | キング |
| 1 | クイーン |
| 2-3 | ルーク1-2 |
| 4-5 | ビショップ1-2 |
| 6-7 | ナイト1-2 |
| 8-15 | ポーン1-8 |

### 黒のピース（ID: 16-31）
| ID | ピース |
|----|--------|
| 16 | キング |
| 17 | クイーン |
| 18-19 | ルーク1-2 |
| 20-21 | ビショップ1-2 |
| 22-23 | ナイト1-2 |
| 24-31 | ポーン1-8 |

## 技術スタック

- **マーカー検出**: [js-aruco2](https://github.com/damianofalcioni/js-aruco2)
- **マーカー生成**: OpenCV.js (marker-generator.html)
- **フロントエンド**: HTML5, CSS3, Vanilla JavaScript

## ファイル構成

```
auto-pgn/
├── index.html              # マーカー検出画面
├── script.js               # 検出ロジック
├── style.css               # スタイル
├── all-markers.html        # 全マーカー一覧（印刷用）
├── marker-generator.html   # 個別マーカー生成
├── lib/
│   ├── cv.js              # js-aruco2コア
│   └── aruco.js           # ArUco検出
└── docs/
    ├── README.md          # 本ファイル
    ├── development-log.md # 制作記録
    └── images/            # スクリーンショット
```

## 開発ロードマップ

### フェーズ1: マーカー検出 ✅
- [x] js-aruco2の導入
- [x] 複数マーカーの同時検出
- [x] マーカー生成ツール
- [x] 印刷用一覧ページ

### フェーズ2: 盤面認識 🚧
- [ ] チェス盤のマス目検出
- [ ] ピース位置の特定
- [ ] 盤面状態の記録

### フェーズ3: 棋譜記録 📋
- [ ] 駒の移動検出
- [ ] PGN形式での記録
- [ ] 棋譜のエクスポート

### フェーズ4: UI/UX改善 📋
- [ ] 盤面の可視化
- [ ] 移動履歴の表示
- [ ] 手動補正機能

## トラブルシューティング

### カメラが起動しない
- ブラウザのカメラ権限を確認してください
- HTTPSまたはlocalhostで実行してください

### マーカーが検出されない
- マーカーが平らになっているか確認してください
- 照明条件を改善してください
- カメラとマーカーの距離を調整してください

### 印刷がずれる
- 印刷設定で「実際のサイズ」を選択してください
- 余白設定を確認してください

## ライセンス

MIT

## 貢献

プルリクエストを歓迎します。大きな変更の場合は、まずissueを開いて変更内容を議論してください。

## 参考資料

- [js-aruco2 ドキュメント](https://github.com/damianofalcioni/js-aruco2)
- [ArUco マーカー](https://www.uco.es/investiga/grupos/ava/portfolio/aruco/)
- [PGN 形式仕様](https://www.chessclub.com/help/PGN-spec)

## 制作記録

詳細な制作過程は[development-log.md](development-log.md)を参照してください。
